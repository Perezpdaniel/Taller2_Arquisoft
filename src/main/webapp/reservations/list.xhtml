<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:b="http://bootsfaces.net/ui">
    <head><meta charset="utf-8"></head><head></head><body><f:view contenttype="text/html">
    <h:head>
        <title>Reservations - Hotel Reservation Management System</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <style>
            .form-container {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 30px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .table-container {
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .status-badge {
                font-size: 0.8em;
                padding: 0.25em 0.6em;
            }
        </style>
    </h:head>

    <h:body>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
            <div class="container">
                <h:link outcome="/index" styleclass="navbar-brand fw-bold text-primary">
                    <i class="fas fa-hotel me-2"></i>Hotel Reservation Management System
                </h:link>
                
                <div class="navbar-nav ms-auto">
                    <h:link outcome="/clients/list" styleclass="nav-link">
                        <i class="fas fa-users me-1"></i>Clients
                    </h:link>
                    <h:link outcome="/reservations/list" styleclass="nav-link active">
                        <i class="fas fa-calendar-check me-1"></i>Reservations
                    </h:link>
                </div>
            </div>
        </nav>

        <div class="container my-5">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col">
                    <h2 class="fw-bold text-primary">
                        <i class="fas fa-calendar-check me-2"></i>Reservations Management
                    </h2>
                    <p class="text-muted">Manage the reservations of the hotel's rooms</p>
                </div>
            </div>

            <!-- Messages -->
            <h:messages globalonly="false" showdetail="true" showsummary="true" styleclass="alert" infoclass="alert alert-info" errorclass="alert alert-danger" warnclass="alert alert-warning">

            <!-- Form Section -->
            <div class="row mb-4">
                <div class="col">
                    <div class="form-container">
                        <h4 class="mb-3">
                            <i class="fas fa-calendar-plus me-2"></i>
                            #{reservationBean.editingMode ? 'Edit Reservation' : 'New Reservation'}
                        </h4>
                        
                        <h:form id="reservationForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <h:outputlabel for="client" value="Client" styleclass="form-label">
                                    <h:selectonemenu id="client" value="#{reservationBean.clientIdSelected}" styleclass="form-select" required="true" requiredmessage="The client is required">
                                        <f:selectitem itemlabel="Select client..." itemvalue="">
                                        <f:selectitems value="#{reservationBean.clients}" var="client" itemlabel="#{client.name}" itemvalue="#{client.id}">
                                    </f:selectitems></f:selectitem></h:selectonemenu>
                                </h:outputlabel></div>
                                
                                <div class="col-md-6">
                                    <h:outputlabel for="room" value="Room Number" styleclass="form-label">
                                    <h:inputtext id="room" value="#{reservationBean.reservation.roomNumber}" styleclass="form-control" required="true" requiredmessage="The room number is required">
                                    <div class="form-text">
                                        <h:outputtext value="#{reservationBean.isRoomAvailable() ? 'Room available' : 'Room occupied'}" styleclass="#{reservationBean.isRoomAvailable() ? 'text-success' : 'text-danger'}">
                                    </h:outputtext></div>
                                </h:inputtext></h:outputlabel></div>
                                
                                <div class="col-md-6">
                                    <h:outputlabel for="startDate" value="Start Date" styleclass="form-label">
                                    <h:inputtext id="startDate" value="#{reservationBean.reservation.startDate}" styleclass="form-control" required="true" requiredmessage="The start date is required">
                                        <f:convertdatetime pattern="yyyy-MM-dd">
                                    </f:convertdatetime></h:inputtext>
                                    <div class="form-text">Minimum date: #{reservationBean.getMinimumDate()}</div>
                                </h:outputlabel></div>
                                
                                <div class="col-md-6">
                                    <h:outputlabel for="endDate" value="End Date" styleclass="form-label">
                                    <h:inputtext id="endDate" value="#{reservationBean.reservation.endDate}" styleclass="form-control" required="true" requiredmessage="The end date is required">
                                        <f:convertdatetime pattern="yyyy-MM-dd">
                                    </f:convertdatetime></h:inputtext>
                                    <div class="form-text">
                                        Duration: #{reservationBean.calculateDurationDays()} day(s)
                                    </div>
                                </h:outputlabel></div>
                                
                                <div class="col-md-6">
                                    <h:outputlabel for="state
                                    <h:selectonemenu id="state" value="#{reservationBean.reservation.state}" styleclass="form-select">
                                        <f:selectitems value="#{reservationBean.reservationStates}" var="state" itemlabel="#{state.description}" itemvalue="#{state}">
                                    </f:selectitems></h:selectonemenu>
                                </h:outputlabel></div>
                                
                                <div class="col-12">
                                    <h:outputlabel for="observations" value="Observations" styleclass="form-label">
                                    <h:inputtextarea id="observations" value="#{reservationBean.reservation.observations}" styleclass="form-control" rows="3">
                                </h:inputtextarea></h:outputlabel></div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col">
                                    <h:commandbutton value="#{reservationBean.editingMode ? 'Update' : 'Save'}" action="#{reservationBean.saveReservation()}" styleclass="btn btn-primary me-2" disabled="#{not reservationBean.isRoomAvailable()}">
                                    <h:commandbutton value="Cancel" action="#{reservationBean.cancel()}" styleclass="btn btn-secondary" immediate="true">
                                </h:commandbutton></h:commandbutton></div>
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="row mb-4">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-search me-2"></i>Search Reservations
                            </h5>
                            <h:form>
                                <div class="row g-3">
                                    <div class="col-md-8">
                                        <h:inputtext value="#{reservationBean.searchTerm}" placeholder="Search by room number or client name..." styleclass="form-control">
                                    </h:inputtext></div>
                                    <div class="col-md-4">
                                        <h:commandbutton value="Search" action="#{reservationBean.searchReservations()}" styleclass="btn btn-outline-primary me-2">
                                        <h:commandbutton value="Clear" action="#{reservationBean.clearSearch()}" styleclass="btn btn-outline-secondary">
                                    </h:commandbutton></h:commandbutton></div>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reservations Table -->
            <div class="row">
                <div class="col">
                    <div class="table-container">
                        <div class="table-responsive">
                            <ui:repeat value="#{reservationBean.reservations}" var="reservation">
                                        </ui:repeat><ui:fragment rendered="#{empty reservationBean.reservations}">
                                        </ui:fragment><table class="table table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Client</th>
                                        <th>Room</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Days</th>
                                        <th>State</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                            <td>#{reservation.id}</td>
                                            <td>#{reservation.client.name}</td>
                                            <td>#{reservation.roomNumber}</td>
                                            <td>
                                                <f:convertdatetime value="#{reservation.startDate}" pattern="dd/MM/yyyy">
                                            </f:convertdatetime></td>
                                            <td>
                                                <f:convertdatetime value="#{reservation.endDate}" pattern="dd/MM/yyyy">
                                            </f:convertdatetime></td>
                                            <td>#{reservation.calculateDurationDays()}</td>
                                            <td>
                                                <span class="badge status-badge 
                                                    #{reservation.state == 'CONFIRMED' ? 'bg-success' : 
                                                      reserva.estado == 'CANCELLED' ? 'bg-danger' : 
                                                      reserva.estado == 'COMPLETED' ? 'bg-info' : 'bg-warning'}">
                                                    #{reservation.state.description}
                                                </span>
                                            </td>
                                            <td>
                                                <h:form style="display: inline;">
                                                    <h:commandlink action="#{reservationBean.editReservation()}" styleclass="btn btn-sm btn-outline-primary me-1">
                                                        <i class="fas fa-edit"></i>
                                                        <f:setpropertyactionlistener target="#{reservationBean.reservationSelected}" value="#{reservation}">
                                                    </f:setpropertyactionlistener></h:commandlink>
                                                    
                                                    <ui:fragment rendered="#{reservation.state == 'CONFIRMED'}">
                                                        <h:commandlink action="#{reservationBean.cancelReservation()}" styleclass="btn btn-sm btn-outline-warning me-1" onclick="return confirm('Are you sure you want to cancel this reservation?')">
                                                            <i class="fas fa-times"></i>
                                                            <f:setpropertyactionlistener target="#{reservationBean.reservationSelected}" value="#{reservation}">
                                                        </f:setpropertyactionlistener></h:commandlink>
                                                    </ui:fragment>
                                                    
                                                    <ui:fragment rendered="#{reservation.state == 'CANCELLED'}">
                                                        <h:commandlink action="#{reservationBean.deleteReservation()}" styleclass="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this reservation?')">
                                                            <i class="fas fa-trash"></i>
                                                            <f:setpropertyactionlistener target="#{reservationBean.reservationSelected}" value="#{reservation}">
                                                        </f:setpropertyactionlistener></h:commandlink>
                                                    </ui:fragment>
                                                </h:form>
                                            </td>
                                        </tr>
                                    
                                    <tr>
                                            <td colspan="8" class="text-center text-muted py-4">
                                                <i class="fas fa-calendar-times fa-2x mb-2"></i><br>
                                                No reservations registered
                                            </td>
                                        </tr>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </h:messages></div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Set minimum date for date inputs
                const today = new Date().toISOString().split('T')[0];
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().split('T')[0];
                
                const fechaInicioInput = document.getElementById('reservationForm:startDate');
                const fechaFinInput = document.getElementById('reservationForm:endDate');
                
                if (fechaInicioInput) {
                    fechaInicioInput.min = tomorrowStr;
                    fechaInicioInput.addEventListener('change', function() {
                        if (endDateInput) {
                            fechaFinInput.min = this.value;
                        }
                    });
                }
                
                if (fechaFinInput) {
                    fechaFinInput.min = tomorrowStr;
                }
            });
        </script>
    </h:body>
</f:view>
</body></html>
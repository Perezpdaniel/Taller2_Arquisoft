<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <title>Clients - Hotel Reservation Management System</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

<style>
    .form-container { background: #f8f9fa; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .table-container { background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
    
    /* Ensure buttons display properly */
    .btn {
        display: inline-block;
        padding: 0.5rem 1rem;
        margin-bottom: 0;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: center;
        text-decoration: none;
        vertical-align: middle;
        cursor: pointer;
        border: 1px solid transparent;
        border-radius: 0.375rem;
        transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .btn-success {
        color: #fff;
        background-color: #198754;
        border-color: #198754;
    }
    
    .btn-success:hover {
        color: #fff;
        background-color: #157347;
        border-color: #146c43;
    }
    
    .btn-info {
        color: #fff;
        background-color: #0dcaf0;
        border-color: #0dcaf0;
    }
    
    .btn-info:hover {
        color: #fff;
        background-color: #3dd5f3;
        border-color: #25cff2;
    }
    
    .btn-lg {
        padding: 0.5rem 1rem;
        font-size: 1.25rem;
        border-radius: 0.5rem;
    }
    
    .me-3 {
        margin-right: 1rem !important;
    }
    
    /* Ensure form controls display properly */
    .form-control {
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .form-control:focus {
        color: #212529;
        background-color: #fff;
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .btn-outline-primary {
        color: #0d6efd;
        border-color: #0d6efd;
        background-color: transparent;
    }
    
    .btn-outline-primary:hover {
        color: #fff;
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    
    .btn-outline-secondary {
        color: #6c757d;
        border-color: #6c757d;
        background-color: transparent;
    }
    
    .btn-outline-secondary:hover {
        color: #fff;
        background-color: #6c757d;
        border-color: #6c757d;
    }
    
    .btn-primary {
        color: #fff;
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    
    .btn-primary:hover {
        color: #fff;
        background-color: #0b5ed7;
        border-color: #0a58ca;
    }
    
    .btn-secondary {
        color: #fff;
        background-color: #6c757d;
        border-color: #6c757d;
    }
    
    .btn-secondary:hover {
        color: #fff;
        background-color: #5c636a;
        border-color: #565e64;
    }
    
    .btn-outline-danger {
        color: #dc3545;
        border-color: #dc3545;
        background-color: transparent;
    }
    
    .btn-outline-danger:hover {
        color: #fff;
        background-color: #dc3545;
        border-color: #dc3545;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        border-radius: 0.25rem;
    }
    
    .me-1 {
        margin-right: 0.25rem !important;
    }
    
    .me-2 {
        margin-right: 0.5rem !important;
    }
</style>

</h:head>

<h:body>
<f:view>
<f:event type="preRenderView" listener="#{clientBean.initialize()}"/>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
        <h:link outcome="/index" styleClass="navbar-brand fw-bold text-primary">
            <i class="fas fa-hotel me-2"></i>Hotel Reservation Management System
        </h:link>
    </div>
</nav>

<div class="container my-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h2 class="fw-bold text-primary">
                        <i class="fas fa-users me-2"></i>Clients Management
                    </h2>
                    <p class="text-muted">Manage the information of the hotel's clients</p>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="window.location.href='../index.xhtml'">
                    <i class="fas fa-home me-1"></i>Home
                </button>
            </div>
        </div>
    </div>

    <!-- Messages -->
    <h:messages globalOnly="false" showDetail="true" showSummary="true"
                styleClass="alert" infoClass="alert alert-info" errorClass="alert alert-danger" warnClass="alert alert-warning"/>

    <!-- Action Buttons -->
    <h:form id="actionButtonsForm">
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body text-center">
                        <button type="button" class="btn btn-success btn-lg me-3" onclick="scrollToForm()">
                            <i class="fas fa-user-plus me-2"></i>New Client
                        </button>

                        <button type="button" class="btn btn-info btn-lg" onclick="scrollToSearch()">
                            <i class="fas fa-search me-2"></i>Search Clients
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </h:form>

    <!-- Form Section -->
    <h:panelGroup id="clientForm">
        <div class="row mb-4">
            <div class="col">
                <div class="form-container">
                    <h4 class="mb-3">
                        <i class="fas fa-user-plus me-2"></i>
                        #{clientBean.editingMode ? 'Edit Client' : 'New Client'}
                    </h4>

                    <h:form id="clientDataForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <h:outputLabel for="name" value="Full Name" styleClass="form-label"/>
                                <h:inputText id="name" value="#{clientBean.client.name}" styleClass="form-control"
                                             required="true" requiredMessage="The name is required"/>
                            </div>

                            <div class="col-md-6">
                                <h:outputLabel for="email" value="Email" styleClass="form-label"/>
                                <h:inputText id="email" value="#{clientBean.client.email}" styleClass="form-control"
                                             required="true" requiredMessage="The email is required">
                                    <f:ajax event="blur" render="@this emailMessage saveBtn"/>
                                </h:inputText>
                                <div class="form-text">
                                    <h:outputText id="emailMessage"
                                                  value="#{clientBean.isEmailAvailable() ? 'Email available' : 'Email already exists'}"
                                                  styleClass="#{clientBean.isEmailAvailable() ? 'text-success' : 'text-danger'}"/>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h:outputLabel for="phone" value="Phone" styleClass="form-label"/>
                                <h:inputText id="phone" value="#{clientBean.client.phone}" styleClass="form-control"
                                             required="true" requiredMessage="The phone is required"/>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col">
                                <h:commandButton id="saveBtn"
                                                 value="#{clientBean.editingMode ? 'Update' : 'Save'}"
                                                 action="#{clientBean.saveClient()}"
                                                 styleClass="btn btn-primary me-2"
                                                 disabled="#{not clientBean.isEmailAvailable()}">
                                    <f:ajax execute="@form" render="@form clientsTable messages"/>
                                </h:commandButton>

                                <h:commandButton value="Cancel"
                                                 action="#{clientBean.cancel()}"
                                                 styleClass="btn btn-secondary"
                                                 immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandButton>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>
    </h:panelGroup>

    <!-- Search Section -->
    <h:panelGroup id="searchSection">
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-search me-2"></i>Search Clients
                        </h5>
                        <h:form id="searchForm">
                            <div class="row g-3">
                                <div class="col-md-8">
                                    <h:inputText id="searchTerm" value="#{clientBean.searchTerm}"
                                                 styleClass="form-control"
                                                 placeholder="Search by name..."/>
                                </div>
                                <div class="col-md-4">
                                    <h:commandButton id="searchBtn" value="Search"
                                                     action="#{clientBean.searchClients()}"
                                                     styleClass="btn btn-outline-primary me-2">
                                        <f:ajax render="clientsTable messages"/>
                                    </h:commandButton>

                                    <h:commandButton id="clearBtn" value="Clear"
                                                     action="#{clientBean.clearSearch()}"
                                                     styleClass="btn btn-outline-secondary"
                                                     immediate="true">
                                        <f:ajax render="clientsTable searchForm"/>
                                    </h:commandButton>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>
    </h:panelGroup>

    <!-- Clients Table -->
    <h:panelGroup id="clientsTable">
        <div class="row">
            <div class="col">
                <div class="table-container">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <ui:repeat value="#{clientBean.clients}" var="client">
                                    <tr>
                                        <td>#{client.id}</td>
                                        <td>#{client.name}</td>
                                        <td>#{client.email}</td>
                                        <td>#{client.phone}</td>
                                        <td>
                                            <h:form style="display:inline;">
                                                <h:commandButton value="Edit"
                                                                 styleClass="btn btn-sm btn-outline-primary me-1"
                                                                 action="#{clientBean.editClient()}">
                                                    <f:setPropertyActionListener target="#{clientBean.clientSelected}" value="#{client}"/>
                                                    <f:ajax render="clientForm"/>
                                                </h:commandButton>

                                                <h:commandButton value="Delete"
                                                                 styleClass="btn btn-sm btn-outline-danger"
                                                                 action="#{clientBean.deleteClient()}"
                                                                 onclick="return confirm('Are you sure you want to delete this client?');">
                                                    <f:setPropertyActionListener target="#{clientBean.clientSelected}" value="#{client}"/>
                                                    <f:ajax render="clientsTable messages"/>
                                                </h:commandButton>
                                            </h:form>
                                        </td>
                                    </tr>
                                </ui:repeat>

                                <ui:fragment rendered="#{empty clientBean.clients}">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-4">
                                            <i class="fas fa-users fa-2x mb-2"></i><br/>
                                            No clients registered
                                        </td>
                                    </tr>
                                </ui:fragment>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </h:panelGroup>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function scrollToForm() {
        document.getElementById('clientForm').scrollIntoView({ behavior: 'smooth' });
    }
    function scrollToSearch() {
        document.getElementById('searchSection').scrollIntoView({ behavior: 'smooth' });
    }
</script>

</f:view>
</h:body>

</html>

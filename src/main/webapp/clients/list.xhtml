<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jakarta.ee/jsf/html" xmlns:f="http://xmlns.jakarta.ee/jsf/core" xmlns:ui="http://xmlns.jakarta.ee/jsf/facelets">
    <h:head>
        <title>Clients - Hotel Reservation Management System</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
        <style>
            .form-container { background: #f8f9fa; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
            .table-container { background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        </style>
    </h:head>

    <h:body>
        <f:view>
        <!-- Initialize the bean -->
        <f:event type="preRenderView" listener="#{clientBean.inicializar()}"/>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
            <div class="container">
                <h:link outcome="/index" styleClass="navbar-brand fw-bold text-primary">
                    <i class="fas fa-hotel me-2"></i>Hotel Reservation Management System
                </h:link>
            </div>
        </nav>

        <div class="container my-5">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h2 class="fw-bold text-primary">
                                <i class="fas fa-users me-2"></i>Clients Management
                            </h2>
                            <p class="text-muted">Manage the information of the hotel's clients</p>
                        </div>
                        <button type="button" class="btn btn-outline-primary" onclick="window.location.href='../index.xhtml'">
                            <i class="fas fa-home me-1"></i>Home
                        </button>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <h:messages globalOnly="false" showDetail="true" showSummary="true"
                        styleClass="alert" infoClass="alert alert-info" errorClass="alert alert-danger" warnClass="alert alert-warning"/>

            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col">
                    <div class="card">
                        <div class="card-body text-center">
                            <button type="button" class="btn btn-success btn-lg me-3" onclick="scrollToForm()">
                                <i class="fas fa-user-plus me-2"></i>New Client
                            </button>
                            <button type="button" class="btn btn-info btn-lg" onclick="scrollToSearch()">
                                <i class="fas fa-search me-2"></i>Search Clients
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Section -->
            <div class="row mb-4" id="clientForm">
                <div class="col">
                    <div class="form-container">
                        <h4 class="mb-3">
                            <i class="fas fa-user-plus me-2"></i>
                            #{clientBean.editingMode ? 'Edit Client' : 'New Client'}
                        </h4>
                        
                        <h:form id="clientForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <h:outputLabel for="name" value="Full Name" styleClass="form-label"/>
                                    <h:inputText id="name" value="#{clientBean.client.name}" styleClass="form-control" required="true" requiredMessage="The name is required"/>
                                </div>
                                
                                <div class="col-md-6">
                                    <h:outputLabel for="email" value="Email" styleClass="form-label"/>
                                    <h:inputText id="email" value="#{clientBean.client.email}" styleClass="form-control" required="true" requiredMessage="The email is required"/>
                                    <div class="form-text">
                                        <h:outputText value="#{clientBean.isEmailAvailable() ? 'Email available' : 'Email already exists'}"
                                                      styleClass="#{clientBean.isEmailAvailable() ? 'text-success' : 'text-danger'}"/>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h:outputLabel for="phone" value="Phone" styleClass="form-label"/>
                                    <h:inputText id="phone" value="#{clientBean.client.phone}" styleClass="form-control" required="true" requiredMessage="The phone is required"/>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col">
                                    <h:commandButton id="saveBtn" value="#{clientBean.editingMode ? 'Update' : 'Save'}" action="#{clientBean.saveClient()}" styleClass="btn btn-primary me-2" type="submit" disabled="#{not clientBean.isEmailAvailable()}"/>
                                    <h:commandButton id="cancelBtn" value="Cancel" action="#{clientBean.cancel()}" styleClass="btn btn-secondary" type="submit" immediate="true"/>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="row mb-4" id="searchSection">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-search me-2"></i>Search Clients
                            </h5>
                            <h:form id="searchForm">
                                <div class="row g-3">
                                    <div class="col-md-8">
                                        <h:inputText id="searchTerm" value="#{clientBean.searchTerm}" 
                                                   placeholder="Search by name..." styleClass="form-control"/>
                                    </div>
                                    <div class="col-md-4">
                                        <h:commandButton id="searchBtn" value="Search" 
                                                       action="#{clientBean.searchClients()}" 
                                                       styleClass="btn btn-outline-primary me-2"/>
                                        <h:commandButton id="clearBtn" value="Clear" 
                                                       action="#{clientBean.clearSearch()}" 
                                                       styleClass="btn btn-outline-secondary" 
                                                       immediate="true"/>
                                    </div>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Table -->
            <div class="row">
                <div class="col">
                    <div class="table-container">
                        <div class="table-responsive" id="clientsTable">
                            <table class="table table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ui:repeat value="#{clientBean.clients}" var="client">
                                        <tr>
                                            <td>#{client.id}</td>
                                            <td>#{client.name}</td>
                                            <td>#{client.email}</td>
                                            <td>#{client.phone}</td>
                                            <td>
                                                <h:form id="actionForm#{client.id}" style="display:inline;">
                                                    <h:commandButton id="editBtn#{client.id}" action="#{clientBean.editClient()}" styleClass="btn btn-sm btn-outline-primary me-1" type="submit">
                                                        <i class="fas fa-edit"></i>
                                                        <f:setPropertyActionListener target="#{clientBean.clientSelected}" value="#{client}"/>
                                                    </h:commandButton>
                                                    
                                                    <h:commandButton id="deleteBtn#{client.id}" action="#{clientBean.deleteClient()}" styleClass="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('Are you sure you want to delete this client?')">
                                                        <i class="fas fa-trash"></i>
                                                        <f:setPropertyActionListener target="#{clientBean.clientSelected}" value="#{client}"/>
                                                    </h:commandButton>
                                                </h:form>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                    <ui:fragment rendered="#{empty clientBean.clients}">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">
                                                <i class="fas fa-users fa-2x mb-2"></i><br/>
                                                No clients registered
                                            </td>
                                        </tr>
                                    </ui:fragment>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            function scrollToForm() {
                document.getElementById('clientForm').scrollIntoView({ behavior: 'smooth' });
            }
            function scrollToSearch() {
                document.getElementById('searchSection').scrollIntoView({ behavior: 'smooth' });
            }
        </script>
        </f:view>
    </h:body>
</html>